---
layout: layouts/post.njk
title: >
      006 RailsClips Testing APIs with Faraday
date: 2015-07-24 08:00:23
episode_number: 006
duration: 6:43
audio_url: 
tags: rails-clips
---

This video goes over end-to-end testing of APIs when the setup is a little more involved or where Rack::Test won't work.

Usually this requires deploying the API application to a server or heroku and setting up any services it depends on. Then we test the entire system front-to-back by making HTTP requests to the API endpoints using <a href="https://github.com/lostisland/faraday" data-cke-saved-href="https://github.com/lostisland/faraday">faraday</a>.

In this case, we're using <a href="https://github.com/typicode/json-server" data-cke-saved-href="https://github.com/typicode/json-server">json-server</a>Â as an example API for testing. It requires that you have <a href="https://nodejs.org/" data-cke-saved-href="https://nodejs.org/">Node.js</a> installed after which you can install json-server with npm.
<blockquote>$ npm install -g json-server</blockquote>
We copied the example db.json from the README of the json-server project and started json-server.
<blockquote>$ json-server --watch db.json</blockquote>
Then we wrote the tests with <a href="https://github.com/lostisland/faraday" data-cke-saved-href="https://github.com/lostisland/faraday">faraday</a> making HTTP requests to the server endpoint and validating the result
<blockquote>
<pre>require 'faraday'
require 'json'

describe "api access to posts" do
  let(:conn) {Faraday.new(url: "http://localhost:3000")}

  it "gets a list of posts" do
    resp = conn.get("/posts")

    posts = JSON.parse(resp.body)
    expect(posts.size).to eq(1)

    post = posts.first
    expect(post["title"]).to eq("json-server")
    expect(post["author"]).to eq("typicode")
  end

  it "gets a single post" do
    resp = conn.get("/posts/1")

    post = JSON.parse(resp.body)
    expect(post["title"]).to eq("json-server")
    expect(post["author"]).to eq("typicode")
  end
end</pre>
</blockquote>

<h3>Transcript</h3>


