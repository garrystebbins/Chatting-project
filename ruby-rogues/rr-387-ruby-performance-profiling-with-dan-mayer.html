---
layout: layouts/post.njk
title: >
      RR 387: Ruby Performance Profiling with Dan Mayer
date: 2018-11-06 11:00:05
episode_number: 387
duration: 48:37
audio_url: https://media.devchat.tv/ruby-rogues/RR_387_Ruby_Performance_Profiling_with_Dan_Mayer.mp3
podcast: ruby-rogues
tags: 
  - ruby-rogues
  - podcast
---

<p class="p1"><span class="s1"><b>Panel: </b></span></p>

<ul>
 	<li class="p1"><span class="s2">Dave Kimura</span></li>
 	<li class="p1"><span class="s2">Charles Max Wood</span></li>
 	<li class="p1"><span class="s2">David Richards</span></li>
</ul>
<p class="p1"><span class="s1"><b>Special Guest:</b></span><span class="s2"> <a href="https://www.mayerdan.com"><span class="s3">Dan Mayer</span></a> </span></p>
<p class="p1"><span class="s2">In this episode of Ruby Rogues, the panel talks with <a href="https://twitter.com/danmayer?lang=en"><span class="s3">Dan Mayer</span></a> who believes that small distributed software teams can make a large impact. Dan loves Ruby, distributed systems, OSS, and making development easier. The panel and Dan talk about performance and benchmarking. Check out today’s episode to learn more! </span></p>
<p class="p1"><span class="s1"><b>Show Topics:</b></span></p>
<p class="p3"><span class="s4">0:00 – <a href="https://sentry.io/welcome/"><span class="s5">Sentry.IO – Advertisement!</span></a> </span></p>
<p class="p1"><span class="s2">1:07 – Chuck: Our panel is Dave, David, myself, and our guest is <a href="https://twitter.com/danmayer?lang=en"><span class="s3">Dan Mayer</span></a>. Say “Hi”! </span></p>
<p class="p1"><span class="s2">1:24 – Chuck: Give a brief introduction, please.</span></p>
<p class="p1"><span class="s2">1:32 – <i>Dan gives his background and what he currently is working on.</i> </span></p>
<p class="p1"><span class="s2">1:53 – Chuck: We wanted to talk to you about benchmarking and performance. Tell us how you got into this?</span></p>
<p class="p1"><span class="s2">2:28 – Dan: It has been an interesting timeline for me. About seven years I worked for a large site that had a legacy Rails app. It got a lot of dusty corners over the years and we removed dead code, and removed bugs and confusion for the consumer. We were finding ways to tweak it and not impacting your users. I was using Trace Point but the overhead was quite significant. I moved away from that project but found that I found a need for it, again, a few years later. I actually tried to modify...and basically Eric said “prove that it is slow.” It really wasn’t the type of bottleneck that I was seeing. Since then I am rewriting it. I removed one bottleneck and now...</span></p>
<p class="p1"><span class="s2">5:00 – Chuck: ...if that number gets smaller then Ruby is doing well. Is it really that simple? How do you benchmark?</span></p>
<p class="p1"><span class="s2">5:15 – <i>Dan answers the question.</i></span></p>
<p class="p1"><span class="s2">6:40 – Panel: How do you benchmark things front to back?</span></p>
<p class="p1"><span class="s2">6:49 – Dan: I look at benchmarking in different layers. You can see the overall impact in the broad range. If you want to see specific things then that’s a little trickier. For Ruby 3x3 he has been working on a Rails Benchmark, and that’s Noah. He has a sample Rails app and...</span></p>
<p class="p1"><span class="s2">8:09 – Chuck: He is using discourse, and we talked to him on a past episode. </span></p>
<p class="p1"><span class="s2">8:20 – Dan: My original plan was to insert my gem within that project. However, I ran into a few issues and Noah and I are working on that because of the issues. </span></p>
<p class="p1"><span class="s2">8:57 – Panel: How does the coverband gem – how does it provide security so you don’t leak out information to in-users?</span></p>
<p class="p1"><span class="s2">9:12 – <i>Dan answers the question.</i></span></p>
<p class="p1"><span class="s2">9:54 – Panel: Then you can build whatever views you want to trace back that sort of information?</span></p>
<p class="p1"><span class="s2">10:02 – <i>Dan answers the question.</i></span></p>
<p class="p1"><span class="s2">10:30 – Chuck: Is it running benchmarks against every method you have in your app or what?</span></p>
<p class="p1"><span class="s2">10:40 – <i>Dan answers question.</i> </span></p>
<p class="p5"><span class="s2">11:27 – Panel: I like when I can remove all of the code I feel safe.</span></p>
<p class="p5"><span class="s2">1:37 – Dan: The gem was driven by the fact that I love to delete code. These old files have been sitting around – they aren’t valid – let’s get rid of them.</span></p>
<p class="p5"><span class="s2">12:04 – Chuck: This is off topic from benchmarking, but...</span></p>
<p class="p5"><span class="s2">12:43 – Dan: ...to get that feature at run time it can hurt your performance. </span></p>
<p class="p5"><span class="s2">15:20 – Panel: Is there added memory usage? </span></p>
<p class="p5"><span class="s2">15:27 – Dan: I rewrote the library around coverage and I put it out. It worked well for my company and myself. But people were saying that they got a huge performance hit. I went from needing to sample to capture...the new bottleneck was collecting the data all of the code usage of your gems and...it went from just recording your custom code to all Ruby code. Where it was slowing down was reporting that. </span></p>
<p class="p5"><span class="s2">I didn’t have any benchmarks to capture that. What I was failing to do was...</span></p>
<p class="p5"><span class="s2">I can talk about what I did do to help people if you want?</span></p>
<p class="p5"><span class="s2">17:41 – Chuck: Looking at how much storage is my app using or how much...How can you even begin to isolate it? </span></p>
<p class="p5"><span class="s2">18:11 – Dan: On all the different types of benchmarking – I know there is a benchmarking memory increase. I haven’t benchmarked that, yet. To get at these different levels, how do we ensure that’s fast? It was a new challenge to me. </span></p>
<p class="p5"><span class="s2">19:45 – Panel: It sounds like this has become a practice over the years. Is that how you handle it or how do you like to use it?</span></p>
<p class="p5"><span class="s2">20:07 – Dan: When I started using this benchmarking is because I wanted to solve something. There were several regressions. We’d go back and address it. What I tried doing is put all the benchmarks into the gem.</span></p>
<p class="p5"><span class="s2">I think back by the Ruby 3x3 goals...</span></p>
<p class="p5"><span class="s2">21:49 – Panel: What comes to mind is appreciating well-crafted software that really does well – maybe measure what customer output is? </span></p>
<p class="p5"><span class="s2">22:43 – Dan: What people care about is their application. You can look to see...</span></p>
<p class="p5"><span class="s2">23:33 – Panel: Automating takes that pressure right off of me and I can do </span></p>
<p class="p5"><span class="s2">23:47 – Chuck: Recording all the things you want to do. We are talking about this right now you can record some of it in these tests or...</span></p>
<p class="p5"><span class="s2">24:06 – Dan: I have fixed these performance things in the past. I have more confidence that these things get fixed before they get released. Having that methodology helps a lot.</span></p>
<p class="p6"><span class="s6">24:43 – <a href="https://www.jetbrains.com/ruby/"><span class="s3">Advertisement – RubyMine</span></a></span></p>
<p class="p5"><span class="s2">25:10 – Panel: I think it’s good to see WHERE your application is getting used the most. To see where you have the MOST code usage. </span></p>
<p class="p5"><span class="s2">26:20 – Dan: That’s a good story on back on regressions on benchmarking or performances. </span></p>
<p class="p5"><span class="s2">27:46 – Dan: One thing that I think is interesting – I believe the Rails performance testing has gone blank essentially. There are good articles but in the Rails 5 the guides no longer have any information. There is so much talk about performance and benchmarking but things have gotten lost, too. </span></p>
<p class="p5"><span class="s2">28:28 – Panel: It’s interesting how we get into x, y, and z. We tend to figure it out and some guys focus on the next thing and the next. </span></p>
<p class="p5"><span class="s2">29:24 – Dan: The fads of the things that go in-and-out. It’s definitely coming back: the performance in the Ruby world. My theory is that the tools have gotten that much better and people are doing less. They have offloaded a lot of things for people. It shows, though, it doesn’t do everything. </span></p>
<p class="p5"><span class="s2">30:19 – Panel: I think that’s valuable, too. </span></p>
<p class="p5"><span class="s2">The WHOLE package – this is how we deliver, and these are the tools and the toolkits. I miss Ruby every time that I have to step away b/c I have to use something else.</span></p>
<p class="p5"><span class="s2">31:17 – Dan: It sounds COOL to use Elixir and whatnot, but I just can’t get into it as much as when I use Ruby. When I try to branch out to use another language it isn’t the same.</span></p>
<p class="p5"><span class="s2">31:47 – Panel: When the pressure is high I use Ruby so that’s where my heart is.</span></p>
<p class="p5"><span class="s2">31:58 – Dan: It falls a little short, sometimes, it’s an easy thing that people say: it’s so slow. It’s one of those that we’d like to have a better answer. Is it something that people have thought of as a continual thing or...?</span></p>
<p class="p5"><span class="s2">32:47 – Chuck: It’s generally to resolve an issue here or there.</span></p>
<p class="p5"><span class="s2">32:57 – Panel. </span></p>
<p class="p5"><span class="s2">33:07 – Chuck: When I do use the benchmarks I have added in my test suite a trip wire that validates that it’s under a certain point.</span></p>
<p class="p5"><span class="s2">33:37 – Panel: If I did that my tests would never pass.</span></p>
<p class="p5"><span class="s2">33:45 – Chuck.</span></p>
<p class="p5"><span class="s2">33:49 – Dan: How can you do that reliably where you get the value but you don’t have a bunch of false failures? A person has to do it to see if it is faster/slower. </span></p>
<p class="p5"><span class="s2">34:26 – Panel: For my applications – usually they are slow not b/c of Ruby but b/c of a poor architectural decision we have made. </span></p>
<p class="p5"><span class="s2">Every situation you can go and weight it to see what is best. Ultimately they are the ones that are brining in money into your business. </span></p>
<p class="p5"><span class="s2">35:27 – Chuck: When I add things into my test suites is b/c there was some major performance hiccup where it ruins the user’s flow. </span></p>
<p class="p5"><span class="s2">35:55 – Dan: The way you benchmark it...</span></p>
<p class="p5"><span class="s2">Benchmarking a gem or a library it’s how can it impact other people’s apps. </span></p>
<p class="p5"><span class="s2">And the Ruby 3x3 is proving that it’s faster – what does that mean – and I think Noah has done some great work on.</span></p>
<p class="p5"><span class="s2">36:30 – Dan: The last thing I want to mention is Julia’s work on that is what got me back into coverband. I was thinking I would use a different version of coverband that would use RBSPY. </span></p>
<p class="p5"><span class="s2">37:37 – Chuck: Yeah, that was a great episode.</span></p>
<p class="p5"><span class="s2">37:44 – Dan: I want to play with it some more. I guess I would have to know more in <a href="https://www.rust-lang.org/en-US/"><span class="s3">Rust,</span></a> though.</span></p>
<p class="p5"><span class="s2">37:57 – Chuck: Anything that you are working on within this space?</span></p>
<p class="p5"><span class="s2">38:04 – Dan: There have been 4-5 current people in coverband and we have added a bunch of new benchmarks and they are 60% faster. I am trying to work on getting a simpler version out there. Hopefully it will be live soon after getting rid of the bugs. </span></p>
<p class="p5"><span class="s2">39:05 – Chuck: How can people find you?</span></p>
<p class="p5"><span class="s2">39:10 – Dan: My blog, Twitter, and GitHub!</span></p>
<p class="p5"><span class="s2">39:22 – Chuck: M-A-Y-E-R.</span></p>
<p class="p5"><span class="s2">39:36 – Picks! </span></p>
<p class="p6"><span class="s6">39:40 – <a href="https://www.freshbooks.com"><span class="s3">Advertisement – Fresh Books!</span></a> </span></p>
<p class="p6"><span class="s6">End – <a href="https://www.cachefly.com"><span class="s3">Cache Fly!</span></a> </span></p>
<p class="p8"><span class="s1"><b>Links:</b></span></p>

<ul class="ul1">
 	<li class="li6"><span class="s7"><a href="https://devchat.tv/get-a-coder-job/"><span class="s3">Get a Coder Job Course</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://www.ruby-lang.org/en/"><span class="s3">Ruby</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://www.rust-lang.org/en-US/"><span class="s3">Rust</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="http://www.rubymotion.com"><span class="s3">Ruby Motion</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://rubyonrails.org"><span class="s3">Ruby on Rails</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://angular.io"><span class="s3">Angular</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://github.com/evanphx/benchmark-ips"><span class="s3">Benchmark-IPS</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://github.com/rbspy/rbspy"><span class="s3">Rbspy</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://www.mayerdan.com/ruby/2018/03/25/ruby-benchmarking"><span class="s3">Ruby Benchmarking</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://www.mayerdan.com/ruby/2018/06/10/benchmarking_bugs"><span class="s3">Benchmarking Bugs</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://github.com/danmayer/coverband"><span class="s3">Coverband</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://ruby-doc.org/core-2.0.0/TracePoint.html"><span class="s3">TracePoint</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://devchat.tv/ruby-rogues/rr-362-measuring-ruby-performance-with-rails-and-discourse-with-noah-gibbs/"><span class="s3">RR 362 Episode</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://guides.rubyonrails.org/v3.2.13/performance_testing.html"><span class="s9">Rails Guides</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://jamesclear.com/atomic-habits"><span class="s9">Atomic Habits</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="http://easyresapp.com"><span class="s9">EasyRes</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://www.skinnypop.com"><span class="s9">Skinny Pop</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://blog.appsignal.com/2018/09/28/active-record-vs-ecto.html"><span class="s9">Blog through AppSignal</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://www.amazon.com/Extreme-Ownership-U-S-Navy-SEALs-ebook/dp/B0739PYQSS/ref=as_li_ss_tl?s=digital-text&amp;ie=UTF8&amp;qid=1539709987&amp;sr=1-1&amp;keywords=extreme+ownership&amp;dpID=51LA5FKuExL&amp;preST=_SY445_QL70_&amp;dpSrc=srch&amp;linkCode=sl1&amp;tag=devchattv-20&amp;linkId=d170287249014e59a063d6862b21b920&amp;language=en_US"><span class="s9">Book: Extreme Ownership</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://twitter.com/codefolio"><span class="s9">Noah Gibbs’ Twitter</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://www.mayerdan.com"><span class="s9">Dan Mayer’s Blog</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://twitter.com/danmayer?lang=en"><span class="s9">Dan Mayer’s Twitter</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://github.com/danmayer"><span class="s9">Dan Mayer’s GitHub</span></a></span></li>
 	<li class="li6"><span class="s8"><a href="https://medium.com/@danmayer/highlights"><span class="s9">Dan Mayer’s Medium</span></a></span></li>
</ul>
<p class="p8"><span class="s1"><b>Sponsors:</b></span></p>

<ul class="ul1">
 	<li class="li6"><span class="s7"><a href="https://sentry.io/welcome/"><span class="s3">Sentry</span></a></span></li>
 	<li class="li6"><span class="s7"><a href="https://www.jetbrains.com/ruby/"><span class="s3">RubyMine</span></a></span></li>
 	<li class="li6"><span class="s1">Cache Fly</span></li>
 	<li class="li6"><span class="s8"><a href="https://www.freshbooks.com"><span class="s9">Fresh Books</span></a></span></li>
</ul>
<p class="p8"><span class="s1"><b>Picks:</b></span></p>
<p class="p10"><span class="s2">David</span></p>

<ul class="ul1">
 	<li class="li10"><span class="s10"><a href="https://www.amazon.com/Atomic-Habits-Proven-Build-Break-ebook/dp/B01N5AX61W"><span class="s11">Atomic Habits by James Clear</span></a></span></li>
</ul>
<p class="p10"><span class="s2">Dave </span></p>

<ul class="ul1">
 	<li class="li10"><span class="s10"><a href="http://easyresapp.com/"><span class="s11">EasyRes</span></a></span></li>
 	<li class="li10"><span class="s10"><a href="https://www.skinnypop.com/"><span class="s11">Skinny Pop</span></a></span></li>
</ul>
<p class="p10"><span class="s2">Charles </span></p>

<ul class="ul1">
 	<li class="li10"><span class="s10"><a href="https://www.amazon.com/Extreme-Ownership-U-S-Navy-SEALs-ebook/dp/B00VE4Y0Z2"><span class="s11">Extreme Ownership </span></a></span></li>
 	<li class="li10"><span class="s10"><a href="http://jockopodcast.com/"><span class="s11">Jocko Willink podcast</span></a></span></li>
 	<li class="li10"><span class="s10"><a href="http://2ketodudes.com/"><span class="s11">2 Keto Dudes </span></a></span></li>
 	<li class="li10"><span class="s10"><a href="https://www.ketogenicforums.com"><span class="s11">Ketogenic Forums</span></a></span></li>
</ul>
<p class="p10"><span class="s2">Dan </span></p>

<ul class="ul1">
 	<li class="li10"><span class="s10"><a href="https://www.amazon.com/Artemis-Novel-Andy-Weir-ebook/dp/B06Y55SB48"><span class="s11">Artemis</span></a></span></li>
 	<li class="li10"><span class="s2">https://blog.appsignal.com/2018/09/28/active-record-vs-ecto.html</span></li>
 	<li class="li10"><span class="s2">https://github.com/evanphx/benchmark-ips</span></li>
 	<li class="li10"><span class="s2">https://github.com/rbspy/rbspy</span></li>
</ul>

<h3>Transcript</h3>


