---
layout: layouts/post.njk
title: >
      JSJ 266 NPM 5.0 with Rebecca Turner
date: 2017-06-20 04:00:24
episode_number: 266
duration: 40:53
audio_url: https://media.devchat.tv//js-jabber/JSJ_266_NPM_5.0_with_Rebecca_Turner.mp3
tags: js-jabber
---

On today’s episode of JavaScript Jabber, Charles Max Wood and panelist Joe Eames chat with Rebecca Turner, tech lead for <a href="https://www.npmjs.com/">NPM</a>, a popular Javascript package manager with the worlds largest software registry. Learn about the newly released NPM 5 including a few of the updated features. Stay tuned!
<h5><span style="color: #808080;">[1:58]</span> Was the release of node JS 8 tied to NPM5?</h5>
<ul>
 	<li>Features in NPM5 have been in planning for 2 years now.</li>
 	<li>Planned on getting it out earlier this year.</li>
 	<li>Node 8 was coming out and got pushed out a month.</li>
 	<li>Putting NPM5 into Node 8 became doable.</li>
 	<li>Pushed really hard to get NPM5 into <a href="https://nodejs.org/en/blog/release/v8.0.0/">Node 8</a> so that users would get NPM5 and updates to NPM5.</li>
</ul>
<h5><span style="color: #808080;">[2:58]</span> Why would it matter? NPM doesn’t care right?</h5>
<ul>
 	<li>Right you can use NPM5 with any version of node.</li>
 	<li>Most people don’t update NPM, but upgrade Node.</li>
 	<li>So releasing them together allowed for when people updated Node they would get NPM 5.</li>
</ul>
<h5><span style="color: #808080;">[3:29]</span> How does the upgrade process work if you’re using NVM or some node version manager?</h5>
<ul>
 	<li>Depends. Different approaches for each</li>
 	<li>NVM gets a fresh copy of Node with new globals. NVM5 and Node 8 are bundled.</li>
 	<li>For some, If you manually upgrade NVM you’ll always have to manually. It will keep the one you manually upgraded to.</li>
</ul>
<h5><span style="color: #808080;">[4:16]</span> Why NPM 5?</h5>
<ul>
 	<li>It’s night and day faster.</li>
 	<li>3 to 5 times speed up is not uncommon.</li>
 	<li>Most package managers are slow.</li>
 	<li>NPM 5 is still growing. Will get even faster.</li>
</ul>
<h5><span style="color: #808080;">[5:18]</span> How did you make it faster?</h5>
<ul>
 	<li>The NPM’s cache is old. It’s very slow. Appalling slow.</li>
 	<li>Rewrote cache</li>
 	<li>Saw huge performance gains</li>
</ul>
<h5><span style="color: #808080;">[5:49]</span> What is the function of the cache?</h5>
<ul>
 	<li>Cache makes it so you don’t have to reinstall modules from the internet.</li>
 	<li>It has registry information too.</li>
 	<li>It will now obey http headers for timing out cache.</li>
</ul>
<h5><span style="color: #808080;">[6:50]</span> Other things that made it faster?</h5>
<ul>
 	<li>Had a log file for a long time. It was called <a href="https://docs.npmjs.com/cli/shrinkwrap">shrinkwrap</a>.</li>
 	<li>NPM 5 makes it default.</li>
 	<li>Renamed it to <code>packagelog.json</code></li>
 	<li>Exactly like shrinkwrap package file seen before</li>
 	<li>In combo with cache, it makes it really fast.</li>
 	<li>Stores information about what the tree should look like and it’s general structure.</li>
 	<li>It doesn’t have to go back and learn versions of packages.</li>
</ul>
<h5><span style="color: #808080;">[7:50]</span> Can you turn the default Packagelog.json off?</h5>
<ul>
 	<li>Yes. Just:</li>
 	<li>Set <code>packagelog=false</code> in the npmrc</li>
</ul>
<h5><span style="color: #808080;">[8:01]</span> Why make it default? Why wasn’t it default before?</h5>
<ul>
 	<li>It Didn’t have it before. Shrinkwrap was added as a separate project enfolded in NPM and wasn’t core to the design of NPM.</li>
 	<li>Most people would now benefit from it. Not many scenarios where you wouldn’t want one.</li>
 	<li>Teams not using the same tools causes headaches and issues.</li>
</ul>
<h5><span style="color: #808080;">[9:38]</span> Where does not having a lock show up as a problem?</h5>
<ul>
 	<li>It records the versions of the packages installed and where NPM put them so that when you clone a project down you will have exactly the same versions across machines.</li>
 	<li>Collaborators have the exact same version.</li>
 	<li>Protects from issues after people introduce changes and patch releases.</li>
 	<li>NPM being faster is just a bonus.</li>
 	<li>Store the sha512 of the package that was installed in the glock file so that we can verify it when you install. It’s Bit for bit what you had previously.</li>
</ul>
<h5><span style="color: #808080;">[11:12]</span> Could you solve that by setting the package version as the same version as the .Json file?</h5>
<ul>
 	<li>No. That will lock down the versions of the modules that you install personally, not the dependancies, or transitive dependancies.</li>
 	<li>Package log allows you to look into the head of the installer. This is what the install looks like.</li>
</ul>
<h5><span style="color: #808080;">[12:16]</span> Defaulting the log file speed things up? How?</h5>
<ul>
 	<li>It doesn’t have to figure out dependences or the tree which makes it faster.</li>
 	<li>Shrinkwrap command is still there, it renames it to shrinkwrap but shrinkwrap cannot be published.</li>
 	<li>For application level things or big libraries, using shrinkwrap to lock down versions is popular.</li>
</ul>
<h5><span style="color: #808080;">[13:42]</span> You’ve Adopted specifications in a ROC process. When did you guys do that?</h5>
<ul>
 	<li>Did it in January</li>
 	<li>Have been using them internally for years. Inviting people into the process.</li>
 	<li>Specifications</li>
 	<li>Written in the form of “Here is the problem and here are the solutions.”</li>
 	<li>Spec folder in NPM docs, things being added to that as they specify how things work.</li>
 	<li>Spec tests have been great.</li>
</ul>
<h5><span style="color: #808080;">[14:59]</span> The update adds new tools. Will there be new things in registry as well?</h5>
<ul>
 	<li>Yes.</li>
 	<li>Information about a package from registry, it returns document that has info about every version and package json data and full readme for every version.</li>
 	<li>It gets very large.</li>
 	<li>New API to request smaller version of that document.</li>
 	<li>Reduces bandwidth, lower download size, makes it substantially faster.</li>
 	<li>Used to be hashed with sha1, With this update it will be hashed with sha512 as well as sha1 for older clients.</li>
</ul>
<h5><span style="color: #808080;">[16:20]</span> Will you be stopping support for older versions?</h5>
<ul>
 	<li>LTS version of NPM was a thing for a while. They stopped doing that.</li>
 	<li>Two models, people either use whatever version came with Node or they update to the latest.</li>
 	<li>The NPM team is really small. Hard to maintain old NPM branches.</li>
 	<li>Supports current versions and that’s pretty much it.</li>
 	<li>If there are big problems they will fix old versions. Patches , etc.</li>
</ul>
<h5><span style="color: #808080;">[17:36]</span> Will there ever be problems with that?</h5>
<ul>
 	<li>Older versions should continue to work. Shouldn’t break any of that.</li>
 	<li>Can’t upgrade from 0.8.</li>
 	<li>It does break with different Node version</li>
 	<li>Does not support Node versions 0.10 or 0.12.</li>
</ul>
<h5><span style="color: #808080;">[18:47]</span> How do you upgrade to NPM?</h5>
<ul>
 	<li><code>sudo npm install -gmpm</code></li>
 	<li>Yes, you may not need sudo. depend on what you’re on.</li>
</ul>
<h5><span style="color: #808080;">[19:07]</span> How long has it been since version 4?</h5>
<ul>
 	<li>Last October is when it came out.</li>
</ul>
<h5><span style="color: #808080;">[19:24]</span> Do you already have plans for version 6?</h5>
<ul>
 	<li>Yes!</li>
 	<li>More releases than before coming up.</li>
 	<li>Finally deprecating old features that are only used in a few packages out of the whole registry.</li>
 	<li>Running tests on getting rid of things.</li>
</ul>
<h5><span style="color: #808080;">[20:50]</span> Self healing cache. What is it and why do we want it?</h5>
<ul>
 	<li>Users are sometimes showing up where installs are broken and tarbols are corrupted.</li>
 	<li>This happens sometimes with complicated containerization setups makes it more likely. It’s unclear where the problem actually is.</li>
 	<li><a href="https://www.npmjs.com/package/cacache">CaCache</a> - content addressable cache. Take the hash of your package and use it to look up address to look it up in the cache.</li>
 	<li>Compares the Tarbol using an address to look it up in the cache.</li>
 	<li>Compares to see if it’s old. Trashes old and downloads updated one.</li>
 	<li>Came out with the cache. Free side effect of the new cache.</li>
</ul>
<h5><span style="color: #808080;">[23:14]</span> New information output as part of the update?</h5>
<ul>
 	<li>NPM has always gave back you the tree from what you just installed.</li>
 	<li>Now, trees can be larger and displaying that much information is not useful.</li>
 	<li>User patch - gives you specifically what you asked for.</li>
 	<li>Information it shows will be something like: “I installed 50 items, updated 7, deleted 2.”</li>
</ul>
<h5><span style="color: #808080;">[24:23]</span> Did you personally put that together?</h5>
<ul>
 	<li>Yes, threw it together and then got feedback from users and went with it.</li>
 	<li>Often unplanned features will get made and will be thrown out to get feedback.</li>
 	<li>Another new things ls output now shows you modules that were deduped. Shows logical tree and it’s relationships and what was deduped.</li>
</ul>
<h5><span style="color: #808080;">[25:27]</span> You came up to node 4 syntax. Why not go to node 8?</h5>
<ul>
 	<li>To allow people with just node 4 be able to use NPM.</li>
 	<li>Many projects still run Node 4. Once a project has been deployed, people generally don’t touch it.</li>
</ul>
<h5><span style="color: #808080;">[26:20]</span> Other new features? What about the File Specifier?</h5>
<ul>
 	<li>File specifier is new. File paths can be in package json, usually put inside pointing to something inside your package.</li>
 	<li>It will copy from there to your node modules.</li>
 	<li>Just a node module symlink.</li>
 	<li>Much faster. Verifiable that what’s in your node modules matches the source. If it’s pointing at the right place it’s correct. If not, then it’s not.</li>
 	<li>Earlier, sometimes it was hard to tell.</li>
</ul>
<h5><span style="color: #808080;">[27:38]</span> Anything else as part of the NPM 5 release? Who do you think will be most affected by it?</h5>
<ul>
 	<li>For the most part, people notice three things:</li>
 	<li>1st. no giant tree at the end</li>
 	<li>2nd. Much faster</li>
 	<li>3rd. Package lock.</li>
</ul>
<h5><span style="color: #808080;">[28:14]</span> If it’s locked, how do you update it?</h5>
<ul>
 	<li>Run <code>npm installer</code> and then <code>npm update</code></li>
 	<li>Used to be scary, but works well now.</li>
 	<li>Updates to latest semver, matches semver to package json to all node modules.</li>
 	<li>Updates package lock at the same time</li>
 	<li>Summary in Git shows what’s changed.</li>
</ul>
<h5><span style="color: #808080;">[28:59]</span> Did Yarn come into play with your decisions with this release?</h5>
<ul>
 	<li>The plans have been in play for a long time for this update.</li>
 	<li><a href="https://yarnpkg.com/en/">Yarn’s</a> inclusion of similar features and the feedback was an indicator that some of the features were valuable.</li>
</ul>
<h5><span style="color: #808080;">[29:53]</span> Other plans to incorporate features similar to yarn?</h5>
<ul>
 	<li>Features are already pretty close.</li>
 	<li>There are other alternative package managers out there.</li>
 	<li>PMPM interesting because when it installs it doesn’t copy all the files. It creates hard links.</li>
</ul>
<h5><span style="color: #808080;">[30:28]</span> Does PMPM and Yarn use NPM registry?</h5>
<ul>
 	<li>Yes! Other than CNPM. The NPM client used in China.</li>
 	<li>CNPM Registry mirror behind firewall. Have their own client to their registry. Their registry is a copy of ours.</li>
</ul>
<h5><span style="color: #808080;">[31:15]</span> What about RNPM?</h5>
<ul>
 	<li>I wouldn’t be surprised.</li>
</ul>
<h5><span style="color: #808080;">[31:45]</span> “Won’t you come and say something controversial about your competitor?”</h5>
<ul>
 	<li>We all want it to be collaborative.</li>
 	<li>When we were writing our new cache, we also helped Yarn with their cache and sped things up tremendously.</li>
</ul>

<hr />

<h4>Picks</h4>
<h5>Charles</h5>
<a href="http://rushrevere.com/AdventureSeriesBooks/index.html">Rush Limbaugh’s children’s books</a>
<a href="http://www.kiwicrate.com/tinker">Tinker Crate</a>
<a href="http://www.kiwicrate.com/">Kiwi Crate</a>
<a href="https://www.npmjs.com/">NPM</a>
<a href="https://devchat.tv/js-jabber">Episodes on My JS Story.</a>
<h5>Joe</h5>
<a href="http://disneyxd.disney.com/gravity-falls">Gravity Falls</a>
Board Games
<h5>Rebecca</h5>
<a href="https://www.npmjs.com/package/npx">NPX</a>
<a href="https://github.com/iarna/funstream">Funstream</a>

<hr />

<h4>Links to keep up with NPM and Rebecca</h4>
<a href="https://twitter.com/ReBeccaOrg">Twitter @rebeccaorg</a>
<a href="https://twitter.com/npmjs">NPMjS on Twitter</a>
<a href="https://blog.npmjs.com/">blog.npmjs.com</a>

<hr />

<h3>Transcript</h3>

<h2 style="text-align: center;"><strong>JSJ 266: NPM 5.0 with Rebecca Turner</strong></h2>
<strong>CHARLES:</strong>

Joe has his own recording booth that’s why you hear opening and shutting. Of course when we started podcasting, Joe’s recording booth is his car so…

[Music]

<em>[Have you ever felt like you’re falling behind or the programming world is moving so fast that it’s impossible to keep up? Then, there’s the issue of where to go to ensure you’re up to date. The answer is to join a community dedicated to discussing the latest in Javascript. Would it be nice if you’ve got Javascript Jabber all day? Well, you can, kind of. We’ve created a Slack community for Javascript Jabber. That means you can collect with our listeners and guests on a platform you’re most likely you’re already using. Plus, we set up a keeping current channel that pulls stories from across the web to help you know what people are talking about. And coming soon, we’ll be holding monthly webinars and round table video chats to connect with experts, the community and each other. So come and join us at javascriptjabber.com/slack.]</em>

<strong>CHARLES:</strong>

Hey, everybody and welcome to another Javascript Jabber. This week on our panel, we have Joe Eames.

<strong>JOE:</strong>

Hey.

<strong>CHARLES: </strong>

I’m Charles Max Wood from Devchat.tv and we have a special guest this week and that’s Rebecca Turner.

<strong>REBECCA:</strong>

Hey.

<strong>CHARLES:</strong>

You have been on for a little while. Although, we did just do the My JS Story, do you want to give everyone a brief introduction?

<strong>REBECCA:</strong>

Sure. I’m the tech lead for the NPM team, which is me and Kat Marchan. And we’re going to produce the actual NPM command that you run on the command line.

<strong>CHARLES:</strong>

Awesome. I think it’s fair to assume that we’ve talked about NPM in the past. Most Javascript developers are aware of what it is, if they not use it every day. I think that’s the function of what their job is. So let’s just dive right into this. NPM released version 5.

<strong>REBECCA:</strong>

Yeah. We’re very excited about this.

<strong>CHARLES:</strong>

Now, one question that I have is we’re talking to the Node.js folks on Friday about Node.js 8. Were the two tied together at all because it seemed like one happened right around the other one?

<strong>REBECCA:</strong>

Well, you know, the features that are in NPM 5, we’ve been talking about going on two years now. We started concrete planning to get them out in the first couple of quarters this year last November. And the first year is like, well, we knew Node.js 8 is coming out and it would be great but we don’t think we can hit that deadline. And then, Node.js got pushed out a month. Suddenly, it became something we can actually do. We pushed really hard to actually have it to a point where we can get it into Node.js 8, so that Node.js 8 users will get NPM 5 and get the updates from the NPM 5.

<strong>CHARLES:</strong>

Why would it matter? I mean, isn’t NPM pretty agnostic to the version of Node.js you run?

<strong>REBECCA:</strong>

Actually, NPM doesn’t care. if you manually upgrade your NPM, you can use NPM 5 and 8<sup>th</sup> version of Node.js. But most users of Node don’t upgrade their NPM binary by hand, they upgrade their Node.js.

<strong>CHARLES:</strong>

Oh, right. I got you. So essentially, what you’re saying is, you wanted it out before Node.js 8 so that when people upgraded Node.js, they got an NPM 5.

<strong>REBECCA:</strong>

Right, exactly.

<strong>JOE:</strong>

Now, what about if you’re using NVM or some Node Version Manager on Windows? Then, how does the upgrade process work then? Do you have to manually upgrade?

<strong>REBECCA:</strong>

Oh, it depends on which one you’re using. They have different approaches to this. Like with NVM, you get a completely fresh copy of Node.js with new globals for every version of Node.js. So if you switch to Node.js 8, with NVM, then, you get NPM 5 with the version that’s bundled with… version of Node.js 8. With the older version with some of the other version managers, I’m not familiar but I know that some of them preserve their globals. So if you manually upgraded your NPM, then, you will always have to manually upgrade NPM because it will keep the one that you manually upgraded to.

<strong>JOE:</strong>

Awesome.

<strong>CHARLES:</strong>

Makes sense. So why NPM 5? I mean, isn’t NPM already awesome?

<strong>REBECCA:</strong>

Sure! But the biggest thing is that it is really super-fast – it’s so much faster than previous versions of NPM. It is night and day faster. If there is a lot, depending on what your project looks like, 3-5 times speed up are not uncommon. So you know, what was a minute install taking 20 seconds, it’s really a substantial improvement.

<strong>CHARLES:</strong>

That’s nice. I’m pretty used to package managers just taking forever any way. They just go slow. Sorry, it has to go on the internet and download crap that’s slow.

<strong>REBECCA:</strong>

Sure. If your internet is slow, it’s still going to be slow because we can’t fix that. We’ve done this as much as we can in other areas. And there’s actually… there’s still a lot of room for improvement. I expect NPM 5 can get even faster.

<strong>CHARLES:</strong>

So what do you do? I mean, what did you do to make it faster?

<strong>REBECCA:</strong>

Well, it turns out that NPM’s cache dates back to Node.js 0.2 or something. It’s really slow. None of us were aware of just how slow it was. It was so slow that if you are in a fast network, it was sometimes no faster. It was appallingly slow. And so the big thing that we started working last November was rewriting the cache. When we dropped that in, that’s when we saw this huge performance gains.

<strong>CHARLES:</strong>

Now, what is the function of the cache?

<strong>REBECCA:</strong>

Cache is just so you don’t have to re-download modules as you get them off as NPM installs your project. So if you install a project, and then, go install something else that uses the same modules like your old test frameworks, then it will install it from the cache, instead of having to download it off the internet.

<strong>CHARLES:</strong>

Okay. I was just curious because sometimes they also cache registries, information and things like that.

<strong>REBECCA:</strong>

We cache that, as well. It’s also the registry information. And that’s actually one of the big changes there. Previously, we have some bespoke rules for how long we’ve to wait to hand out your cache. And we now obey whatever the HTTP headers are. For registry metadata, if somebody upgrades this module and somebody upgrades the version, you won’t see the update for five minutes because that was the website is telling us to do.

<strong>CHARLES:</strong>

Gotcha. Were there any other major things that you did that made it faster? Or was it all just the cache?

<strong>REBECCA:</strong>

Oh no. There was one other major thing which was… we had a lock file for a long time. Although, we didn’t call it a lock file. We called it shrinkwrap. This was a point of confusion for people but what NPM 5 does is it makes that the default. And we renamed it so it’s called package-lock.json. And it is in fact, actually, exactly like shrinkwrap file that we had previously. But that, in conjunction, with the improved cache, makes the install process that much faster because the lock file essentially acts as a cache. It installs its ideas about what your tree should look like. So if your lock file… doesn’t have to think that again. Doesn’t have to go, “Alright, which versions of which packages already got that file?”

<strong>CHARLES:</strong>

By the way, making that default, thank you.

<strong>REBECCA:</strong>

Yes. Yes, it has been a huge improvement for everyone.

<strong>CHARLES:</strong>

If people want to turn that off, can they?

<strong>REBECCA:</strong>

Yes. They can set packagelock false in their npmrc.

<strong>CHARLES:</strong>

Okay.

<strong>JOE:</strong>

So why decide to make it default the old way, I mean, is everybody not served, as well, with the way that, I guess, lock files didn’t… I’m not sure what to say here… the way the lock files didn’t work? Is that bad for everybody?

<strong>REBECCA:</strong>

What you’re asking is, if it’s default now, why isn’t it default before?

<strong>JOE:</strong>

Yeah.

<strong>REBECCA:</strong>

Originally, we didn’t have any lock file when we were first working at it. And like a lot of things in NPM, incrementally, we got things added to it. So when the shrinkwrap was added, which is for all intents and purposes, a lock file, it was initially, actually, a separate project that was then, folded in to NPM. That means it wasn’t core. People who have been using NPM, didn’t expect to have it there. They’ve gotten used to… they didn’t use them. But I think, most people are better served by having them. I think that it’s a great decision to always have a package lock. There aren’t many scenarios where you don’t want one.

<strong>CHARLES:</strong>

Yeah, it eliminates a lot of issues with… “Oh well, I got a package that’s a different version from the one I expected,” or “I do an npm install in my machine. And then, my co-worked does an npm install in their machine.” Since it’s pulling a package version that I already have in my machine, I have a much older than theirs so stuff breaks on my machine. And then, they fix it. Then, it breaks on their machine. And, yeah…

<strong>REBECCA:</strong>

Yeah, it ensures that all of the person in a project are using the same tools.

<strong>CHARLES:</strong>

Yup. Well also on appointment, you know. It eliminates issues there too. And I’ve had all of those headaches in many languages.

<strong>JOE:</strong>

So if we didn’t have a lock, can we maybe talk about a scenario where this actually shows up? if you’re probably one of those people that are out there that have just been taking your basic Node and have it run, maybe they aren’t doing so much the way of devops, right? And they haven’t seen this problem. Can you kind of explain and talk about why, what that does and what it solves?

<strong>REBECCA:</strong>

So when you run npm install, it records the versions of all the packages that you installed in to your Node modules folder. And it records where NPM decided to put them. That way, when you get a new laptop and clone your project down, you’ll have exactly the same versions of everything that you’ve had on your previous machine. It also needs… to everyone that operating with. It has the exact version of everything, which relates to that whole thing where...

Cinder is a statement of intent for humans and humans screw that up. You’re not supposed to introduce breaking changes and patch releases but that doesn’t mean people don’t. This protects you from that. I would say that’s the biggest piece. The fact that it makes npm able to be much faster with it is a bonus. But other thing that it allowed us to do is that we now store the SHA sum of the package. Actually, we store a SHA-512 that’s available of the package that was installed in the file so that we can verify it when you go to install. So that you know that it’s bit for bit identical to what you had previously.

<strong>JOE:</strong>

So can’t you just solve the problem by setting the package version to be in exact version of the package.json file? Is that not good enough?

<strong>REBECCA:</strong>

That does an excellent point. So no, you can’t because… lock down the versions of the modules that you personally install. It doesn’t lock down the versions of all of their dependencies.

<strong>JOE:</strong>

Interesting.

<strong>REBECCA:</strong>

Because you’re setting the version of that and everyone uses Cinder for the dependencies, it doesn’t lock down any of your, what we call, transitive dependencies – the dependencies of your dependencies.

<strong>CHARLES:</strong>

Right. I think I’m spoiled on this a little bit because I came up through Ruby and used bundler. And this is what bundler does.

<strong>REBECCA:</strong>

It’s also... one of the things that I like about it, apart from an npm developer point of view, is that the package lock allows you to look inside the head of the installer. Like, this is the installer stating its intent, or like, this is what the install should look like. I’m just going to save this here and I’m going to make your install look like that.

<strong>CHARLES:</strong>

Now, one thing that you’ve mentioned is that the shrinkwrap being default speed things up. Is that because it doesn’t have to do as much dependencies or figuring out the dependencies? Or there’s more to it than that?

<strong>REBECCA:</strong>

No, that is what primarily what it does. That’s why it’s faster. It’s both that it doesn’t have to figure out the dependencies and it doesn’t have to figure out where they go in your tree. Shrinkwrap describes exactly what your node modules will look like - or the package lock. I should say that we still need the npm shrinkwrap command, but actually it is now renamed your package lock - npm shrinkwrap. The difference between the two files is that package lock can’t be published. Npm shrinkwrap can. So if you’re publishing an application and you want to lock down your dependency versions. Happy is just a shrinkwrap. And they want to build to go, “Alright, this version of happy, we’ve tested it with this version of our dependencies. We don’t want to have support issues from someone who used a newer version of one of those dependencies so we’re going to lock everything down.”

You really don’t want to do this on your small libraries because that would make the tree… it will make much harder… you can actually create much more difficult situations. You get the dif-tree again but for application-level things or like big libraries, frameworks, it is a popular approach to using shrinkwrap to lock down specifically what your users might be using.

<strong>CHARLES:</strong>

So one other thing that I saw just looking at the blog post here and a few other things that I kind of look at is that, you’ve adopted specifications in an RFC process.

<strong>REBECCA:</strong>

Yes.

<strong>CHARLES:</strong>

When did that happen? Is that old news and I just missed it?

<strong>REBECCA:</strong>

Yeah, we announced this last January. We did some blog post about it and as we’ve been coming across things, we’ve been posting up RFC’s. We’ve been using them internally for several years. And this is mostly just been inviting the community into our process. Specifications thing kind of came out of that. It wasn’t something we’ve talked about previously but we have an RFC and it’s like, “Alright, now, I want to implement the RFC.” The RFC is a request for comment so it’s written in the form of, “Well, here’s this problem we want to solve. Here’s some possible solutions. The specification needs to be, “Well, which one did we actually choose?”

<strong>CHARLES:</strong>

Right.

<strong>REBECCA:</strong>

So with our specs folder in the npm docs… and we’re slowly adding things to that as we specify in detail how they’re going to work. It also allowed us to write spec test, which has been fantastic.

<strong>CHARLES:</strong>

Oh, I’m sure. I have another question. It’s completely unrelated. Joe, do you have anything you want to this before I move on?

<strong>JOE:</strong>

Go ahead.

<strong>CHARLES:</strong>

So one other thing that I saw is that it adds some new tools that are in fact, it says here, “new tools intended for use with upcoming registry features.” So are we looking at new things coming in the registry, as well?

<strong>REBECCA:</strong>

Yes. That is true. Gosh, I’m not sure exactly what that’s referring to specifically. Amongst the new registry features has been… we introduced a… so a normal package, when you get information about a package from the registry, it returns this document that has every version ever of the package. The full package is on data for every package. And that package on data also includes the full README for every version. And so, as you can imagine, this is kind of unbounded help that they can get. For some packages, it is absurdly large. So we have a new API that you can request a smaller version of that document. That helps us by reducing our bandwidth build and also meaning, you don’t have to download so it should be substantially faster.

<strong>CHARLES:</strong>

That makes sense.

<strong>REBECCA: </strong>

So relatedly, the introduction of SHA-512’s, historically, all packages have been hashed with SHA-1 on the registry. With npm 5, we now have to input SHA-1 and SHA-512. We do the SHA-1 because all the older clients need to be able to still install your package. But newer clients will use the SHA-512.

<strong>CHARLES:</strong>

Makes sense. You mentioned the older packages. Are you planning to deprecate or stop support for, say, npm 1 or 2? Maybe you already have and I missed that too.

<strong>REBECCA:</strong>

We don’t actually maintain…we spent a period of time trying to do an LTS version of NPM. And ultimately, we gave up on that because nobody install npm as an LTS. People are in two camps. They either use whatever version came with Node or they upgrade to the latest. Those are the only two models that we came across when we’re doing that. And also, our team is really small. We can’t actually maintain a whole bunch of different branches. Officially, we support the current version of npm and we do not support the older versions. If there’s a security problem, we’ll go to releases on those older versions. Or something particularly like, we’ve done patches there to support Node. Node decides that they want to do an updated LTS release with a new Node chip, then we’ll go to an older release of npm’s for that.

<strong>CHARLES:</strong>

Okay.

<strong>REBECCA:</strong>

But otherwise, no, we just maintained npm 5 because it’s the only npm that we’ll be seeing releases.

<strong>CHARLES:</strong>

I guess what I’m asking though is if I have a really old installation of Node somewhere, it’s running application that don’t really want to bring up the latest version, and I’m kind of too lazy to update npm. Are there other reasons why I do not want to… am I going to see problems with that because you’re not looking at that?

<strong>REBECCA:</strong>

We’re not planning… we do not currently have any plans to deprecate any of the old registry API’s or anything like that. Older versions should continue to work. That also means that the third party npm plans will continue to work, as well. So yeah, no plans to break that. I think we can still upgrade from… well, you can’t upgrade from 0.8 anymore because we thoroughly broke backwards compatibility with that. Well, actually, npm 5 does introduce breaking changes as far as what Node versions it supports. So we finally hit the bullet and Node 5 does not support 0.10 or 0.12. We finally got to use npm 4 features. It’s so lovely.

<strong>CHARLES:</strong>

Nice.

<strong>REBECCA:</strong>

You know, we’re like three years late to the party. It’s okay.

<strong>CHARLES:</strong>

Right. So if you want to upgrade npm, you just sudo npm install –g npm?

<strong>REBECCA:</strong>

That’s right. It depends on your system on whether or not you need sudo. If you’re using a version manager, you probably don’t.

<strong>CHARLES:</strong>

That’s true. I’m just used to working with it either on a Mac or in some kind of Linux terminal where I’m not root. That makes sense.

<strong>JOE:</strong>

I’m kind of curious. How long were you on version 4? Or how long has it been since version 4 came out?

<strong>REBECCA:</strong>

Version 4 came out last October.

<strong>JOE:</strong>

So has it been terribly long. It kind of like 8 months?

<strong>REBECCA:</strong>

Yeah, about that and 7 days.

<strong>JOE:</strong>

Is that the typical cycle? Do you already have plans for version 6?

<strong>REBECCA:</strong>

We do! We’re really moving towards more releases than we’ve done previously. Some of this has to do with finally deprecating features that are used in 3 packages and all the registry. Thankfully, a question… we have the tools now to easily ask those questions, too. So we regularly, run tests of like, “Can we get rid of this? Does anyone use this at all?” We recently found out that one of the more esoteric features of npm is in fact used by a couple hundred packages on the registry. It gets the undocumented behavior and they rely on them. It’ll break if you change it.

<strong>JOE:</strong>

Interesting.

<em>[This episode is sponsored by hired.com. Every week on hired, they run an option where a thousand tech companies in San Francisco, New York and LA bid on Javascript developers providing them with salary and equity upfront. The average Javascript developer gets an average of 5 to 15 introductory offers and an average salary offer of a $130,000 a year. Users can either accept an offer, go right into interviewing of a company, or an item without a continuing obligations. It’s totally free for users and when you’re hired, they also give you a $2,000 bonus as a thank you for using them. But if you use the Ruby Rogues link, you’ll get a $4,000 bonus instead. Finally, if you’re not looking for a job but know someone who is, you can refer them to Hired and get $137,000 bonus if they accept the job. Go sign up at hired.com/javascriptjabber.]</em>

<strong>JOE:</strong>

I have another question. One of the things mentioned is the self-healing cache. What kind of deal is that? I’ve used npm for a long time. I’ve never felt like I needed a self-healing cache. Can you explain what that is, why we want it and why you did it?

<strong>REBECCA:</strong>

Well, you wouldn’t really know if you did because it wasn’t before. As supposed it… wait, won’t usually show up as you would have broken install it previously because it will gone to get a tarball out of there, and the tarball would have been corrupted. I’ve never personally let this happen to my cache. With some regularity, they’re showing up if this is a problem. Usually because they’re using complicated software environments or other things, it makes that more likely. Maybe it has something to do with overlay file systems, and something writing to it under the real file system and overlay at the same time. I don’t know.

What this actually means is that the new cache is based on a module called ca-cache. And that stands for content-addressable cache. By content-addressable, what we need is we take a cryptographic hash of you package and we use that as an address to look it up in our cache. And then, when we read that tarball out of our cache, we verify it against the content address that we’re given. And if it doesn’t match, then, we throw it away and download it again. If there’s any corruption in there, it just transparently tosses out the old cache entry and gets a new one.

<strong>JOE:</strong>

I think that makes sense. So was that a very common problem?

<strong>REBECCA:</strong>

Well…

<strong>JOE:</strong>

You said it never happened to you.

<strong>REBECCA:</strong>

Like I said, it’s hard to measure how common is this problem. It’s common enough that like I said, with some regularity issues of people who run it. And as I said, they are mostly people using complicated containerization setups so there seems to be something about that that causes this to happen. We don’t really know what.

<strong>JOE:</strong>

Gotcha. So how long was that on the plan to take care of that?

<strong>REBECCA:</strong>

That just came out on the cache rewrite. That came for free because we’ve been planning to do this content-addressable cache. When we did that, simply say, a free side effect of that. You have to make like cool little gifts of manually corrupting our cache…

<strong>JOE:</strong>

Alright, so the other feature that’s listed is new information output, right?

<strong>REBECCA:</strong>

Right. So this is something that we’ve had on the table for a long time. It was making the result that you’ve unpack from the npm install be more useful. The result that you got… npm always, historically, giving you the tree of what you just installed. Npm 2 and earlier gave you a separate tree for every module install. And npm 3 just gave you a single tree.

Well, either way, it seemed like a great thing when you’re installing modules. These days, I installed just my base setup environment and I have 300 modules in my tree. That tree is… just blame that in the output is not useful. We’ve got rid of that and turned it into a summary. And actually, we’ve already accepted a user patch that now also summarizes, specifically, what you asked from the command line if you ask for anything there. So if you do npm install, name a thing and it will tell you, “Yeah, I installed that thing for you and this is the version we found for that.” And then, it also says, “I installed 50 items, updated 7, and deleted 2.”

<strong>JOE:</strong>

I see. Do you have a lot of big-handed to the exact design of that? Was that based on your own personal experience as to how it ended up getting designed?

<strong>REBECCA:</strong>

Yeah, I mean I just got do something together and put it out there. And then, we got feedback from users and we iterated on it.

<strong>JOE:</strong>

Okay, cool.

<strong>REBECCA:</strong>

And that’s one of those things that they have these experimental branches, where it will get a brainstorm and put something together. It won’t have any tests and it won’t have deeper product… Just push it out there. This release we got to actually… natural release process. One of the other related things that came out of that is probably new to you if you’re just upgrading npm 5 is ls output now shows you modules that were… It shows you the full logical tree of here’s everything and how it relates to each other. Some places here, we didn’t actually install module there. It’s just conceptually there. So that’s a little marker next to the item in the list.

<strong>JOE:</strong>

Right. That’s cool.

<strong>CHARLES:</strong>

So I have a question. You mentioned you were able to come up to Node 4. Why not just go all the way to Node 8?

<strong>REBECCA:</strong>

Because we want Node 4 users to still be able to update their npm.

<strong>CHARLES:</strong>

Oh, I guess that makes sense. Well, there are wider systems like AWS Lambda, for example, that still use Node 4 so that makes a lot of sense.

<strong>REBECCA:</strong>

Yeah. The percentage of users on Node 4 is still pretty substantial. I haven’t seen the latest numbers recently but I know that 0.10 and 0.12 together are under 5% now. That’s a very recent change. It’s because once something is deployed to operations, no one wants to touch it because it works. I wouldn’t want to upgrade it if it was mine.

<strong>CHARLES:</strong>

No, that’s true.

<strong>REBECCA:</strong>

Something else that we haven’t talked about is the file specifier. It’s not something that people use that much. But in some people, it’s pretty key to their header packages setup. You can put file pass in your package json. Usually, put this as pointing to something inside your package and it would copy from there into your Node modules. We’ve changed this and now, it makes a simile.

<strong>CHARLES:</strong>

That makes sense.

<strong>REBECCA:</strong>

Yeah. It’s much faster, of course, because we’re just making a simile but we can also verify that what is in our Node modules actually matches the source because it’s just a simile. If the simile gets pointed out in the right place, then, it’s correct. If it’s not, it’s not correct. When it was a bunch of files copied from a folder that maybe were mutated by the post install. It was really hard to tell. That came out of our sitting down, going well. If we make package locks, you know, standard, everybody has to have them. Then, we really have to like, “These cases have to make sense and have to not be in a case where it’s like, ‘well, I changed it and now, it’s not updating in my Node modules, what?’” That one, I hope to, I know, Yarn-landed bare version of the RFC for that feature. I don’t know if they’ve actually gotten in yet but they’re going to be following that. There’s semantics too as I understand that.

<strong>JOE:</strong>

Cool. Is there anything else that we haven’t talked about? Part of the npm5 release? What do you think would be most impacted and most affected by?

<strong>REBECCA:</strong>

I think the first thing that any users can actually… the first thing that most people notice is they don’t get that giant tree at the end. The second thing that they notice is that this is much faster. And then, the package lock is kind of a distant bird. Unless, you’re actually aware of these things and comfortable with them. Most users are, “Huh, well there’s this file here now.” But everything else seems better, so that’s great.

<strong>CHARLES:</strong>

So if it’s locked, how do you update it? Do you just update your package.json and say, I want something else?

<strong>REBECCA:</strong>

Ordinarily, you’d run npm install, npm update. For a long time, npm update has been kind of scary but it works pretty well, now. So you’ll run npm update and it will update to the latest Cinder. If you don’t get any arguments, sudo update to match the Cinder from your package.json all the modules in your modules.

<strong>CHARLES:</strong>

Okay.

<strong>REBECCA:</strong>

And then, it updates your package lock at the same time. And of course, you get an easy way to review that because your package lock is checked in when you go to add that to your kit. It has a summary of change.

<strong>CHARLES:</strong>

Joe, did you get to ask your Yarn question yet?

<strong>JOE:</strong>

Oh no, I totally forgot about that. I wanted to ask. So Yarn has been a thing. People have been talking about it a lot lately, right? And so, when you guys were deciding to do this release, you look a lot what Yarn was doing. Did that affect these decisions on what to put into this release?

<strong>REBECCA:</strong>

Like I said, our plans for this release go back about a year and a half. Two to four Yarns release. It’s not to say that Yarn didn’t have an impact. Things like having a lock file by default was something where we’re sitting there and talking about… we’ve been planning on making the npm shrinkwrap good enough that you’d produce it all the time. Once you have that, then, you can actually have a lock file by default. But Yarn was an excellent indicator that that was something valuable to people. Does that answer your question?

<strong>JOE:</strong>

Yeah, yeah. It does. Other than that, do you have any other plans incorporating features that Yarn has?

<strong>REBECCA:</strong>

Not aware of the substantial… I don’t think that there’s that big of a difference in our feature clarity. There are a lot of alternative package. We’ve also been working pretty close with the developer in pnpm. Pnpm is interesting because it makes it… when it does installs, it doesn’t copy all the files into your Node modules. It makes hyperlinks. It is, by and far, the fastest single package manager for npm.

<strong>CHARLES:</strong>

Now, the Yarn, pnpm, and all the rest of these use the npm registry?

<strong>REBECCA:</strong>

Yes, yeah. Everyone uses the npm registry. The only caveat to that is the npm, which is the npm client that’s primarily used in China. They actually run the registry here behind the firewall for obvious network reasons. You don’t want to do package request over the firewall. So they have their own client that talks privately to their registry. And then, that registry is our full copy of our registry. And they actually have something where you can publish to their registry or our registry. You don’t have to publish ours. It’s not 100% clear to me but, yeah, there are exceptions to that.

<strong>CHARLES:</strong>

Right. What about rnpm which is React Native? Is that completely different registry?

<strong>REBECCA:</strong>

I’m not familiar with it.

<strong>CHARLES:</strong>

Okay. I just never looked so I don’t know.

<strong>REBECCA:</strong>

I would be surprised. Most people are well… we could run our own registry and then, pay all the cost supporting that and have an operations team, or we could just use npm.

<strong>CHARLES:</strong>

Alright, well, are there any other things that you want to talk about, Joe? Or things that you think we should have brought up, Rebecca?

<strong>JOE:</strong>

Nothing on my side.

<strong>REBECCA:</strong>

I got also a few more words about Yarn. Amongst the end users, there’s sometimes say, people are like, “I found this exciting thing and now won’t you come and say something controversial about this competitor of yours?” But the fact is, all of us on all development teams will prefer to speak collaborative. And to that end, one of the purpose that we found in writing our cache, when we were looking at Yarn for the last month of development, we found that they haven’t implemented that. We actually PR-ed that. 20% speed improvement for Yarn, it was substantial.

<strong>CHARLES:</strong>

That’s one thing that I think is cool is maybe somebody wanted to work just a little differently or do something different. Or in this cases, their end… Yeah, that’s great that everybody, you know, you are contributing to them, their contributing to you. Yeah, that’s awesome. Alright, well, let’s go ahead and do some picks.

<em>[This episode is sponsored by Ruby Remote Conf. Ruby Remote Conf is a 2-day completely virtual conference hosted by, none other than, Charles Max Wood. If travel expenses are an issue where you just can't afford to be away from home for 2 days. Then, join us! It’s virtual. This conference is focused on people who are new to programming who want to learn what the pros know, or just get a leg up, and getting a job, and getting into the programming community. We will have speakers from all over the programming community to help you stay current in a Slack room where you can connect with speakers and other attendees in real-time. We’ll also have a live round table video chat for attendees and speakers. Plus, we’ll provide the top recordings to you within days from the conference.]</em>

<strong>CHARLES: </strong>(33:21)

I’ll go ahead and throw out some picks. So my kids, they like to spend time with dad. It’s kind of fun. And so there are a couple of things that I really enjoyed doing with them. One of these picks, I hesitate a little bit to pick just because people have political stances, you know, they’re going to have feelings. But they’re terrific books and if it bothers you that I pick a book by Rush Limbaugh, then just close your ears for a minute. He’s got some children’s books, which are historical novels written for kids. It just tells the story. History teacher takes middle school kids back in time to the American Revolution. They’re really great. I’ve been reading those two. It’s Rush Revere and the Brave Pilgrims. I believe it’s the first one. And there are, I think, 5 total books. My kids are just love them and they know who all these historical figures are, they know what they are famous for. Anyway, they’re tremendous.

The other thing, which if you have… more technical or maybe mechanical engineering bent that we’ve been getting from my kids, they get a Tinker Crate and Kiwi Crate. The Tinker Crates are for the older kids and the Kiwi Crates are for the younger kids. And the last ones that I got from my kids, we have a 3D Viewer that they built with mirrors and then, they have little slots to slide the pictures in. And I built that with the older kids, and the younger kids they have this really, really, fat straws, and you put this phone thing in one end and you put pins on the other end. Then, they have an air bladder with a hose on it. There’s an apparatus you put it into so you can change the angle of the rocket launcher and launch the rockets. They also had kites, like really small kites, and something else in it.

But anyway, so it’s all about air pressure and aerodynamics, just moving things with air. The other one was obviously about optics and light, and things like that. So if you’re into some of that science stuff and you have kids that are… I think the Tinker Crates are for 4<sup>th</sup> to 6<sup>th</sup> grade and the Kiwi Crates are 1<sup>st</sup> to 3<sup>rd</sup> grade. I’ve been doing the Kiwi Crates with my 2<sup>nd</sup> grader and kindergartener, who will now be in 1<sup>st</sup> grade and 3<sup>rd</sup> grade now that it’s summer. Anyway, if you’re looking for some things to do with your kids, those are things that I highly recommend. Joe, do you have some picks?

<strong>JOE:</strong>

Hey, so they launched their show called Gravity Falls. It’s been awesome, really like it. It’s cartoon for adults. So I’m going to pick that. I also want to pick board games, in general. The local store, retail store, near my house is going out of business, the board games store is going out of business, which is kind of sad. But it’s just the way that things work. It’s been a shift in what’s profitable in retail locations, especially when selling things you can’t compete with them. It will be too bad. I miss being able to go to the store and see what’s new about board games. I hope that doesn’t mean that the types of media that are easy for people to consume like video games and TV shows crowd out board games. So I want to pick board games and it’s a great way to spend your time. And that’s my final pick.

<strong>CHARLES:</strong>

Alright, Rebecca. Do you have some picks for us?

<strong>REBECCA: </strong>

Sure. You know, I actually like to pick two like side projects of Kat and me. We both been kind of just living development for the past six months and so other hobbies on the side. But a... these are kind of exciting. So, one is Kat put together a tool called NPX. In NPX, you type in NPX and the name of some command-line tool somewhere on NPM and it installs it and run the command-line for you. And it does this all transparently and if you happen to have it installed locally, it just uses one. It started as a way to run like the stuff that's in your node module that's been... like your life cycle scripts can run but you just want to run it from the command-line you can NPX them.

And she was like, I could just install the module so now it is... completely changes your relationship with these little command-line tools. So you don't need to install rimraf if you want to remove something. You may run NPX rimraf and it will install it and run it for you. So, I think that's really exciting. We may actually bring that into NPM and ship it as an additional binary at some point because it's so good. But it was just a… like that was like a thing that she hacked together in a few hours and was like, "Look at this thing I made!" And it totally changes your relationship with these things.

<strong>CHARLES:</strong>

That's cool.

<strong>REBECCA: </strong>

Yeah. So the other thing is a little library I put together which I called Funstream. And it's about making streams... it gives streams the iterator functions that arrays have. So you can call map, filter, forEach, reduce, and it also makes it so that errors are passed down the chain which is one of the biggest frustrations working with streams ordinarily is that if you do a series of pipes, it just throws away all the errors. And any error that you get just causes the whole program to exit because it's an unhandled error event and node exits on unhandled error events. And to capture them, you have to capture them at each level individually. I miss it why people use tools like Pump. Well, there's another approach to that. It's also faster than using through or writing your own through stream using a series of maps is faster than using through. So, that's an advantage too but I’m having a lot of fun with that. It's where I go to cool down from NPM things.

<strong>CHARLES:</strong>

Nice. Now, I'm going to call out just a couple more things here. On My JS Story, I have interviewed Isaac, Rebecca, and Larry Boss - all from NPM. So if you want to get kind of a picture of who these people are behind the scenes, Isaac also gave a rather interesting history of NPM. So, if you're interested in any of that, then go check My JS Story. And just go see those. Rebecca, if people want to keep up on what's going on with NPM or if they want to keep up on you and your projects and what you're doing, what are the places to go do that?

<strong>REBECCA: </strong>

Well, they should follow me on Twitter at @ReBeccaorg. If they want to follow NPM, we've got @npmjs on Twitter. We also have blog.npmjs.org. I think it was actually last January, we started posting all of our release notes to the blog every time we do our release. We'll be getting back into our normal release soon which means every two weeks, there will be a new NPM release.

<strong>CHARLES:</strong>

Very cool. Alright. Well, we will go ahead and wrap this one up. Thank you for coming and we'll catch every one next week.

<strong>REBECCA: </strong>

Kudos! Thanks for having me.

<em>[Bandwidth for this segment is provided by Cachefly, the world's fastest CDN. To view your content fast with Cachefly, visit cachefly.com to learn more.]</em>
